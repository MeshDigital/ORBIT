<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:SLSKDONET.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="1000"
             x:Class="SLSKDONET.Views.Avalonia.HomePage"
             x:DataType="vm:HomeViewModel"
             Background="#0A0A0B">
    
    <Grid RowDefinitions="Auto,*" Margin="32">
        <!-- Header -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,32">
            <StackPanel Grid.Column="0">
                <TextBlock Text="The Command Center" FontSize="32" FontWeight="Black" Foreground="White" LetterSpacing="-0.5"/>
                <TextBlock Text="Intelligence hub for your music asset management" FontSize="14" Foreground="#808080" Margin="0,4,0,0"/>
            </StackPanel>
            
            <Button Grid.Column="1" Command="{Binding RefreshDashboardCommand}" 
                    Background="Transparent" BorderThickness="0" Padding="8" VerticalAlignment="Top">
                <TextBlock Text="ðŸ”„ Refresh" Foreground="#00A3FF" FontSize="13" FontWeight="SemiBold"/>
            </Button>
        </Grid>
        
        <ScrollViewer Grid.Row="1">
            <StackPanel Spacing="24">
                <!-- Top Bento Row: Core Metrics -->
                <Grid ColumnDefinitions="2*,*,*" RowDefinitions="180">
                    <!-- Library Health Tile -->
                    <Border Grid.Column="0" Background="#121214" CornerRadius="16" Padding="24" BorderBrush="#1F1F23" BorderThickness="1">
                        <Grid RowDefinitions="Auto,*,Auto">
                            <TextBlock Grid.Row="0" Text="LIBRARY HEALTH" FontSize="11" FontWeight="Bold" Foreground="#606060" LetterSpacing="1"/>
                            
                            <StackPanel Grid.Row="1" VerticalAlignment="Center" Spacing="4">
                                <TextBlock Text="{Binding LibraryHealth.TotalTracks, FallbackValue='0'}" FontSize="48" FontWeight="Black" Foreground="White"/>
                                <TextBlock Text="indexed tracks in library" FontSize="13" Foreground="#A0A0A0"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12">
                                <Border Background="#1A1DB954" CornerRadius="6" Padding="8,4">
                                    <TextBlock Text="{Binding LibraryHealth.HqTracks, StringFormat='{}{0} HQ', FallbackValue='0'}" 
                                               FontSize="12" Foreground="#1DB954" FontWeight="Bold"/>
                                </Border>
                                <Border Background="#1AFF6B6B" CornerRadius="6" Padding="8,4">
                                    <TextBlock Text="{Binding LibraryHealth.UpgradableCount, StringFormat='{}{0} to upgrade', FallbackValue='0'}" 
                                               FontSize="12" Foreground="#FF6B6B" FontWeight="Bold"/>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- Session Status Tile -->
                    <Border Grid.Column="1" Background="#121214" CornerRadius="16" Padding="20" BorderBrush="#1F1F23" BorderThickness="1">
                        <Grid RowDefinitions="Auto,*,Auto">
                            <TextBlock Grid.Row="0" Text="SESSION" FontSize="11" FontWeight="Bold" Foreground="#606060" LetterSpacing="1"/>
                            
                            <StackPanel Grid.Row="1" VerticalAlignment="Center" Spacing="8">
                                <Ellipse Width="10" Height="10" HorizontalAlignment="Left" 
                                         Fill="{Binding IsSoulseekConnected, Converter={StaticResource BooleanToStatusColorConverter}}"/>
                                <TextBlock Text="{Binding SessionStatus}" FontSize="18" FontWeight="SemiBold" Foreground="White" TextWrapping="Wrap"/>
                            </StackPanel>
                            
                            <TextBlock Grid.Row="2" Text="{Binding DownloadSpeed, StringFormat='{}â¬‡ {0}'}" FontSize="13" Foreground="#00A3FF" FontWeight="Medium"/>
                        </Grid>
                    </Border>
                    
                    <!-- Storage Insight Tile -->
                    <Border Grid.Column="2" Background="#121214" CornerRadius="16" Padding="20" BorderBrush="#1F1F23" BorderThickness="1">
                        <Grid RowDefinitions="Auto,*,Auto">
                            <TextBlock Grid.Row="0" Text="STORAGE" FontSize="11" FontWeight="Bold" Foreground="#606060" LetterSpacing="1"/>
                            
                            <StackPanel Grid.Row="1" VerticalAlignment="Center" Spacing="12">
                                <ProgressBar Value="65" Height="6" CornerRadius="3" Background="#262629" Foreground="#00A3FF"/>
                                <TextBlock Text="65% Used" FontSize="14" Foreground="White" FontWeight="Medium"/>
                            </StackPanel>
                            
                            <TextBlock Grid.Row="2" Text="420 GB Free" FontSize="12" Foreground="#808080"/>
                        </Grid>
                    </Border>
                </Grid>
                
                <!-- Second Row: Recently Added (Horizontal Scroller) -->
                <StackPanel Spacing="16">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="Recently Added" FontSize="20" FontWeight="Bold" Foreground="White"/>
                        <Button Grid.Column="1" Background="Transparent" Command="{Binding NavigateLibraryCommand}">
                            <TextBlock Text="View All â†’" Foreground="#808080" FontSize="13"/>
                        </Button>
                    </Grid>
                    
                    <ItemsControl ItemsSource="{Binding RecentPlaylists}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="16"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <!-- Using a compact card for dashboard -->
                                <Border Width="180" Background="#121214" CornerRadius="12" Padding="12" BorderBrush="#1F1F23" BorderThickness="1">
                                    <StackPanel Spacing="8">
                                        <Border CornerRadius="8" ClipToBounds="True" Background="#262629">
                                            <Image Source="/Assets/album_placeholder.png" Height="156" Stretch="UniformToFill"/>
                                        </Border>
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="13" TextTrimming="CharacterEllipsis"/>
                                        <TextBlock Text="{Binding SuccessfulCount, StringFormat='{}{0} tracks'}" FontSize="11" Foreground="#808080"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
                
                <!-- Third Row: Spotify Recommendations -->
                <StackPanel Spacing="16">
                    <TextBlock Text="Recommended for You" FontSize="20" FontWeight="Bold" Foreground="White"/>
                    
                    <ItemsControl ItemsSource="{Binding SpotifyRecommendations}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="4" Rows="2" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Grid.ColumnSpan="1" Margin="0,0,16,16" Background="#121214" CornerRadius="12" Padding="12" BorderBrush="#1F1F23" BorderThickness="1">
                                    <Grid ColumnDefinitions="48,*,Auto">
                                        <Border Grid.Column="0" CornerRadius="6" ClipToBounds="True" Width="48" Height="48">
                                            <!-- We would ideally use an AsyncImage control here, for now placeholder -->
                                            <Rectangle Fill="#262629"/>
                                        </Border>
                                        
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Title}" FontWeight="SemiBold" FontSize="13" TextTrimming="CharacterEllipsis"/>
                                            <TextBlock Text="{Binding Artist}" FontSize="11" Foreground="#808080" TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="2" VerticalAlignment="Center" Spacing="4">
                                            <Button Command="{Binding ((vm:HomeViewModel)DataContext).QuickSearchCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                    CommandParameter="{Binding}"
                                                    Padding="6" Background="#1DB954" CornerRadius="4">
                                                <TextBlock Text="ðŸ”" FontSize="12"/>
                                            </Button>
                                            <TextBlock IsVisible="{Binding InLibrary}" Text="âœ¨ In Library" FontSize="9" Foreground="#1DB954" FontWeight="Bold" HorizontalAlignment="Right"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
